<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cardio Schemabouwer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
            color: #e5e7eb; /* text-gray-200 */
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 1rem;
        }
        .app-container {
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 1200px;
            background-color: #1f2937; /* bg-gray-800 */
            border-radius: 1rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }
        @media (min-width: 768px) {
            .app-container {
                flex-direction: row;
                min-height: 80vh;
            }
        }
        .sidebar {
            width: 100%;
            padding: 1.5rem;
            background-color: #111827; /* bg-gray-900 */
            border-bottom: 1px solid #374151; /* border-gray-700 */
        }
        @media (min-width: 768px) {
            .sidebar {
                width: 280px;
                flex-shrink: 0;
                border-right: 1px solid #374151;
                border-bottom: none;
            }
        }
        .main-content {
            flex-grow: 1;
            padding: 1.5rem;
            overflow-y: auto;
            position: relative; /* Voor de settings knop */
        }
        .tab-button {
            padding: 0.75rem 1.25rem;
            font-weight: 600;
            color: #9ca3af;
            border-bottom: 3px solid transparent;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .tab-button.active {
            color: #60a5fa; /* text-blue-400 */
            border-color: #60a5fa;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .drag-item {
            background-color: #374151; /* bg-gray-700 */
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            cursor: grab;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: transform 0.2s ease;
        }
        .drag-item:active {
            cursor: grabbing;
            transform: scale(1.02);
        }
        .drop-zone {
            min-height: 100px;
            border: 2px dashed #4b5563; /* border-gray-600 */
            border-radius: 0.5rem;
            padding: 1rem;
            margin-top: 1rem;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }
        .drop-zone.drag-over {
            background-color: #2d3748; /* bg-gray-700 */
            border-color: #60a5fa; /* border-blue-400 */
        }
        .dropped-item {
            background-color: #2c2c34; /* bg-gray-800 */
            padding: 0.5rem;
            margin-bottom: 0.5rem;
            border-radius: 0.375rem;
            display: flex;
            flex-wrap: wrap; /* Allow content to wrap */
            align-items: center;
            justify-content: space-between;
            font-size: 0.9rem;
            color: #e5e7eb;
        }
        .dropped-item .remove-btn {
            background: none;
            border: none;
            color: #f87171; /* text-red-400 */
            cursor: pointer;
            font-size: 1rem;
            margin-left: 0.5rem;
        }
        .message-box {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }
        .message-box.show {
            opacity: 1;
        }

        /* Dag Weergave Specifieke Stijlen */
        .day-timeline-container {
            display: grid;
            grid-template-columns: 50px 1fr; /* Tijdlabel kolom en inhoudskolom */
            gap: 0.5rem;
            margin-top: 1rem;
            border: 2px dashed #4b5563;
            border-radius: 0.5rem;
            padding: 1rem;
            min-height: 300px; /* Voldoende hoogte voor de tijdlijn */
            position: relative; /* Voor absolute positionering van items */
        }
        .time-labels {
            display: flex;
            flex-direction: column;
            /* Hoogte van 24 uur * 2 slots/uur * 25px/slot = 1200px */
            height: 1200px; /* Vaste hoogte voor tijdlabels */
        }
        .time-slot-label {
            text-align: right;
            padding-right: 0.5rem;
            color: #9ca3af;
            font-size: 0.8rem;
            height: 25px; /* 30 minuten per 25px */
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }
        .day-drop-zone-content { /* Dit is de werkelijke dropzone */
            position: relative; /* Cruciaal voor absolute positioning van children */
            min-height: 1200px; /* Zorg dat het dropgebied groot genoeg is voor 24 uur */
            overflow-y: auto; /* Allow scrolling if items go beyond view */
            padding: 0; /* Remove padding here, items will position themselves */
            border: none; /* Remove border from here, it's on the container */
        }
        .timeline-item {
            position: absolute; /* Position absolutely within day-drop-zone-content */
            left: 0;
            width: 100%; /* Take full width of the content area */
            background-color: #2c2c34;
            border-radius: 0.375rem;
            padding: 0.5rem;
            font-size: 0.9rem;
            color: #e5e7eb;
            min-height: 40px; /* Minimum height for items */
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            transition: background-color 0.2s ease; /* Add transition for visual feedback */
            z-index: 10; /* Ensure items are above drop zone border */
        }
        .timeline-item.hr-zone-bar {
            height: auto; /* Allow content to dictate height */
            min-height: 40px; /* Base height for readability */
            justify-content: flex-start;
            overflow: hidden;
            white-space: nowrap;
        }
        .timeline-item .remove-btn {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            z-index: 1; /* Zorg dat de knop klikbaar is */
        }

        /* Week & Maand Weergave Kalender Stijlen */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); /* Responsive columns */
            gap: 0.5rem; /* gap-2 */
            margin-top: 1rem;
        }
        .calendar-day-cell, .calendar-week-cell {
            background-color: #2c2c34;
            border-radius: 0.5rem;
            min-height: 120px;
            padding: 0.75rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start; /* Align items to top */
            text-align: center;
            border: 2px dashed #4b5563; /* Drop zone style */
        }
        .calendar-day-cell.drag-over, .calendar-week-cell.drag-over {
            background-color: #2d3748;
            border-color: #60a5fa;
        }
        .calendar-day-cell h3, .calendar-week-cell h3 {
            font-weight: bold;
            color: #e5e7eb;
            margin-bottom: 0.5rem;
        }
        .calendar-day-cell .dropped-item, .calendar-week-cell .dropped-item {
            width: 100%;
            margin-bottom: 0.25rem;
            font-size: 0.8rem;
            padding: 0.4rem;
        }

        /* Settings Icon */
        .settings-icon-btn {
            position: absolute;
            top: 1.5rem; /* Aangepast om rechtsboven te staan */
            right: 1.5rem;
            background: none;
            border: none;
            color: #9ca3af;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s ease;
            z-index: 20; /* Zorg dat het boven andere content ligt */
        }
        .settings-icon-btn:hover {
            background-color: #374151;
        }

        /* Categorie selectie */
        .category-select-container {
            margin-bottom: 1rem;
        }
        .category-content {
            display: none;
        }
        .category-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Zijbalk: Beschikbare Modules -->
        <div class="sidebar">
            <h2 class="text-xl font-bold mb-4 text-gray-100">Beschikbare Elementen</h2>

            <div class="category-select-container">
                <label for="category-select" class="block text-sm font-medium text-gray-400 mb-1">Kies Categorie:</label>
                <select id="category-select" class="p-2 rounded-md bg-gray-700 border border-gray-600 text-gray-200 w-full">
                    <option value="cardio">Cardio</option>
                    <option value="strength">Kracht</option>
                    <option value="recovery">Herstel</option>
                    <option value="coordination">Coördinatie</option>
                    <option value="flexibility">Flexibiliteit</option>
                    <option value="speed">Snelheid</option>
                    <option value="nutrition">Voeding</option>
                    <option value="general">Algemeen</option>
                    <option value="standard-schemas">Standaard Schema's</option>
                </select>
            </div>

            <div id="available-modules">
                <!-- Categorie: Cardio -->
                <div id="category-cardio" class="category-content active">
                    <div class="drag-item" draggable="true" data-type="hr-zone" data-name="Rustzone" data-icon="fas fa-bed" data-zone-color="text-gray-400">
                        <span><i class="fas fa-bed mr-2 text-gray-400"></i>Rustzone</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="hr-zone" data-name="Herstelzone (Relaxed)" data-icon="fas fa-leaf" data-zone-color="text-green-400">
                        <span><i class="fas fa-leaf mr-2 text-green-400"></i>Herstelzone (Relaxed)</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="hr-zone" data-name="Actief Laag (HRV)" data-icon="fas fa-walking" data-zone-color="text-lime-400">
                        <span><i class="fas fa-walking mr-2 text-lime-400"></i>Actief Laag (HRV)</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="hr-zone" data-name="Opwarming" data-icon="fas fa-fire" data-zone-color="text-yellow-400">
                        <span><i class="fas fa-fire mr-2 text-yellow-400"></i>Opwarming</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="hr-zone" data-name="Duurzaamheid 1" data-icon="fas fa-heartbeat" data-zone-color="text-blue-400">
                        <span><i class="fas fa-heartbeat mr-2 text-blue-400"></i>Duurzaamheid 1</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="hr-zone" data-name="Duurzaamheid 2" data-icon="fas fa-heartbeat" data-zone-color="text-indigo-400">
                        <span><i class="fas fa-heartbeat mr-2 text-indigo-400"></i>Duurzaamheid 2</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="hr-zone" data-name="Duurzaamheid 3" data-icon="fas fa-heartbeat" data-zone-color="text-purple-400">
                        <span><i class="fas fa-heartbeat mr-2 text-purple-400"></i>Duurzaamheid 3</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="hr-zone" data-name="Intensief 1" data-icon="fas fa-bolt" data-zone-color="text-orange-400">
                        <span><i class="fas fa-bolt mr-2 text-orange-400"></i>Intensief 1</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="hr-zone" data-name="Intensief 2" data-icon="fas fa-bolt" data-zone-color="text-red-400">
                        <span><i class="fas fa-bolt mr-2 text-red-400"></i>Intensief 2</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="hr-zone" data-name="Afkoeling" data-icon="fas fa-snowflake" data-zone-color="text-cyan-400">
                        <span><i class="fas fa-snowflake mr-2 text-cyan-400"></i>Afkoeling</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                </div>

                <!-- Categorie: Kracht -->
                <div id="category-strength" class="category-content">
                    <div class="drag-item" draggable="true" data-type="strength-exercise" data-name="Full Body Training" data-icon="fas fa-dumbbell" data-zone-color="text-red-400">
                        <span><i class="fas fa-dumbbell mr-2 text-red-400"></i>Full Body Training</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="strength-exercise" data-name="Geïsoleerde Training" data-icon="fas fa-hand-fist" data-zone-color="text-orange-400">
                        <span><i class="fas fa-hand-fist mr-2 text-orange-400"></i>Geïsoleerde Training</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="strength-exercise" data-name="Partiële Herhalingen" data-icon="fas fa-arrows-alt-h" data-zone-color="text-yellow-400">
                        <span><i class="fas fa-arrows-alt-h mr-2 text-yellow-400"></i>Partiële Herhalingen</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="strength-exercise" data-name="Plyometrisch" data-icon="fas fa-bounce" data-zone-color="text-lime-400">
                        <span><i class="fas fa-bounce mr-2 text-lime-400"></i>Plyometrisch</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="strength-exercise" data-name="Isometrisch" data-icon="fas fa-grip-lines" data-zone-color="text-green-400">
                        <span><i class="fas fa-grip-lines mr-2 text-green-400"></i>Isometrisch</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                </div>

                <!-- Categorie: Herstel -->
                <div id="category-recovery" class="category-content">
                    <div class="drag-item" draggable="true" data-type="recovery-activity" data-name="Actief Herstel" data-icon="fas fa-walking" data-zone-color="text-blue-400">
                        <span><i class="fas fa-walking mr-2 text-blue-400"></i>Actief Herstel</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="recovery-activity" data-name="Passief Herstel" data-icon="fas fa-couch" data-zone-color="text-indigo-400">
                        <span><i class="fas fa-couch mr-2 text-indigo-400"></i>Passief Herstel</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="recovery-activity" data-name="Foam Rolling" data-icon="fas fa-rolling-ball" data-zone-color="text-purple-400">
                        <span><i class="fas fa-rolling-ball mr-2 text-purple-400"></i>Foam Rolling</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="recovery-activity" data-name="Stretching Sessie" data-icon="fas fa-stretch" data-zone-color="text-pink-400">
                        <span><i class="fas fa-stretch mr-2 text-pink-400"></i>Stretching Sessie</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                </div>

                <!-- Categorie: Coördinatie -->
                <div id="category-coordination" class="category-content">
                    <div class="drag-item" draggable="true" data-type="coordination-activity" data-name="Balansoefeningen" data-icon="fas fa-balance-scale" data-zone-color="text-teal-400">
                        <span><i class="fas fa-balance-scale mr-2 text-teal-400"></i>Balansoefeningen</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="coordination-activity" data-name="Wendbaarheidstraining" data-icon="fas fa-shoe-prints" data-zone-color="text-emerald-400">
                        <span><i class="fas fa-shoe-prints mr-2 text-emerald-400"></i>Wendbaarheidstraining</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="coordination-activity" data-name="Reactietraining" data-icon="fas fa-lightbulb" data-zone-color="text-cyan-400">
                        <span><i class="fas fa-lightbulb mr-2 text-cyan-400"></i>Reactietraining</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                </div>

                <!-- Categorie: Flexibiliteit -->
                <div id="category-flexibility" class="category-content">
                    <div class="drag-item" draggable="true" data-type="flexibility-activity" data-name="Statisch Rekken" data-icon="fas fa-person-praying" data-zone-color="text-fuchsia-400">
                        <span><i class="fas fa-person-praying mr-2 text-fuchsia-400"></i>Statisch Rekken</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="flexibility-activity" data-name="Dynamisch Rekken" data-icon="fas fa-child-reaching" data-zone-color="text-rose-400">
                        <span><i class="fas fa-child-reaching mr-2 text-rose-400"></i>Dynamisch Rekken</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="flexibility-activity" data-name="Yoga Sessie" data-icon="fas fa-om" data-zone-color="text-amber-400">
                        <span><i class="fas fa-om mr-2 text-amber-400"></i>Yoga Sessie</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                </div>

                <!-- Categorie: Snelheid -->
                <div id="category-speed" class="category-content">
                    <div class="drag-item" draggable="true" data-type="speed-activity" data-name="Sprinttraining" data-icon="fas fa-running" data-zone-color="text-red-500">
                        <span><i class="fas fa-running mr-2 text-red-500"></i>Sprinttraining</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="speed-activity" data-name="Interval Snelheid" data-icon="fas fa-tachometer-alt" data-zone-color="text-orange-500">
                        <span><i class="fas fa-tachometer-alt mr-2 text-orange-500"></i>Interval Snelheid</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="speed-activity" data-name="Reactiesnelheid Drill" data-icon="fas fa-stopwatch-20" data-zone-color="text-yellow-500">
                        <span><i class="fas fa-stopwatch-20 mr-2 text-yellow-500"></i>Reactiesnelheid Drill</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                </div>

                <!-- Categorie: Voeding -->
                <div id="category-nutrition" class="category-content">
                    <div class="drag-item" draggable="true" data-type="nutrition-activity" data-name="Maaltijdplan" data-icon="fas fa-utensils" data-zone-color="text-lime-300">
                        <span><i class="fas fa-utensils mr-2 text-lime-300"></i>Maaltijdplan</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="nutrition-activity" data-name="Hydratatie Doel" data-icon="fas fa-water" data-zone-color="text-blue-300">
                        <span><i class="fas fa-water mr-2 text-blue-300"></i>Hydratatie Doel</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="nutrition-activity" data-name="Supplement Inname" data-icon="fas fa-pills" data-zone-color="text-purple-300">
                        <span><i class="fas fa-pills mr-2 text-purple-300"></i>Supplement Inname</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                </div>

                <!-- Categorie: Algemeen -->
                <div id="category-general" class="category-content">
                    <div class="drag-item" draggable="true" data-type="rest-day" data-name="Rustdag" data-icon="fas fa-bed" data-zone-color="text-gray-500">
                        <span><i class="fas fa-bed mr-2 text-gray-500"></i>Rustdag</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="training-measurement" data-name="Trainingsmeting" data-icon="fas fa-chart-line" data-zone-color="text-purple-400">
                        <span><i class="fas fa-chart-line mr-2 text-purple-400"></i>Trainingsmeting</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="rest-measurement-free" data-name="Rustmeting (Vrij)" data-icon="fas fa-heart-pulse" data-zone-color="text-pink-400">
                        <span><i class="fas fa-heart-pulse mr-2 text-pink-400"></i>Rustmeting (Vrij)</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="rest-measurement-base" data-name="Rustmeting (Basis)" data-icon="fas fa-heart-circle-bolt" data-zone-color="text-emerald-400">
                        <span><i class="fas fa-heart-circle-bolt mr-2 text-emerald-400"></i>Rustmeting (Basis)</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="document-link" data-name="Document Koppeling" data-icon="fas fa-file-alt" data-zone-color="text-teal-400">
                        <span><i class="fas fa-file-alt mr-2 text-teal-400"></i>Document Koppeling</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                </div>

                <!-- Categorie: Standaard Schema's -->
                <div id="category-standard-schemas" class="category-content">
                    <h4 class="text-md font-semibold mb-2 text-gray-300">Cardio Schema's</h4>
                    <div class="drag-item" draggable="true" data-type="day" data-name="Basis Cardio Dag" data-icon="fas fa-running" data-content='[{"type":"hr-zone","name":"Opwarming","icon":"fas fa-fire","zoneColor":"text-yellow-400","duration":10,"progressionEnabled":false,"progressionValue":null,"topPosition":0},{"type":"hr-zone","name":"Duurzaamheid 1","icon":"fas fa-heartbeat","zoneColor":"text-blue-400","duration":30,"progressionEnabled":true,"progressionValue":2,"topPosition":50},{"type":"hr-zone","name":"Afkoeling","icon":"fas fa-snowflake","zoneColor":"text-cyan-400","duration":5,"progressionEnabled":false,"progressionValue":null,"topPosition":100}]'>
                        <span><i class="fas fa-running mr-2 text-blue-300"></i>Basis Cardio Dag</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="day" data-name="Gemiddelde Cardio Dag" data-icon="fas fa-running" data-content='[{"type":"hr-zone","name":"Opwarming","icon":"fas fa-fire","zoneColor":"text-yellow-400","duration":10,"progressionEnabled":false,"progressionValue":null,"topPosition":0},{"type":"hr-zone","name":"Duurzaamheid 2","icon":"fas fa-heartbeat","zoneColor":"text-indigo-400","duration":40,"progressionEnabled":true,"progressionValue":3,"topPosition":50},{"type":"hr-zone","name":"Intensief 1","icon":"fas fa-bolt","zoneColor":"text-orange-400","duration":15,"progressionEnabled":false,"progressionValue":null,"topPosition":100},{"type":"hr-zone","name":"Afkoeling","icon":"fas fa-snowflake","zoneColor":"text-cyan-400","duration":5,"progressionEnabled":false,"progressionValue":null,"topPosition":150}]'>
                        <span><i class="fas fa-running mr-2 text-purple-300"></i>Gemiddelde Cardio Dag</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="day" data-name="Gevorderde Cardio Dag" data-icon="fas fa-running" data-content='[{"type":"hr-zone","name":"Opwarming","icon":"fas fa-fire","zoneColor":"text-yellow-400","duration":15,"progressionEnabled":false,"progressionValue":null,"topPosition":0},{"type":"hr-zone","name":"Intensief 2","icon":"fas fa-bolt","zoneColor":"text-red-400","duration":30,"progressionEnabled":true,"progressionValue":5,"topPosition":50},{"type":"hr-zone","name":"Duurzaamheid 3","icon":"fas fa-heartbeat","zoneColor":"text-purple-400","duration":20,"progressionEnabled":false,"progressionValue":null,"topPosition":100},{"type":"hr-zone","name":"Afkoeling","icon":"fas fa-snowflake","zoneColor":"text-cyan-400","duration":10,"progressionEnabled":false,"progressionValue":null,"topPosition":150}]'>
                        <span><i class="fas fa-running mr-2 text-red-300"></i>Gevorderde Cardio Dag</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>

                    <h4 class="text-md font-semibold mt-4 mb-2 text-gray-300">Kracht Schema's</h4>
                    <div class="drag-item" draggable="true" data-type="day" data-name="Basis Kracht Dag" data-icon="fas fa-dumbbell" data-content='[{"type":"strength-exercise","name":"Full Body Training","icon":"fas fa-dumbbell","zoneColor":"text-red-400","inputType":"reps_sets","reps":10,"sets":3,"minReps":8,"maxReps":12,"minSets":3,"maxSets":4,"progressionEnabled":true,"progressionValue":1,"notes":"Focus op techniek","topPosition":0}]'>
                        <span><i class="fas fa-dumbbell mr-2 text-red-300"></i>Basis Kracht Dag</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="day" data-name="Gemiddelde Kracht Dag" data-icon="fas fa-dumbbell" data-content='[{"type":"strength-exercise","name":"Geïsoleerde Training","icon":"fas fa-hand-fist","zoneColor":"text-orange-400","inputType":"reps_sets","reps":8,"sets":4,"minReps":6,"maxReps":10,"minSets":3,"maxSets":5,"progressionEnabled":true,"progressionValue":1,"notes":"Supersets mogelijk","topPosition":0},{"type":"strength-exercise","name":"Plyometrisch","icon":"fas fa-bounce","zoneColor":"text-lime-400","inputType":"time","duration":20,"minTime":15,"maxTime":25,"progressionEnabled":false,"progressionValue":null,"notes":"Explosieve kracht","topPosition":50}]'>
                        <span><i class="fas fa-dumbbell mr-2 text-orange-300"></i>Gemiddelde Kracht Dag</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>

                    <h4 class="text-md font-semibold mt-4 mb-2 text-gray-300">Herstel Schema's</h4>
                    <div class="drag-item" draggable="true" data-type="day" data-name="Actieve Herstel Dag" data-icon="fas fa-walking" data-content='[{"type":"recovery-activity","name":"Actief Herstel","icon":"fas fa-walking","zoneColor":"text-blue-400","inputType":"time","duration":30,"notes":"Lichte wandeling of fietsen","topPosition":0},{"type":"recovery-activity","name":"Stretching Sessie","icon":"fas fa-stretch","zoneColor":"text-pink-400","inputType":"time","duration":15,"notes":"Focus op grote spiergroepen","topPosition":50}]'>
                        <span><i class="fas fa-walking mr-2 text-blue-300"></i>Actieve Herstel Dag</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                    <div class="drag-item" draggable="true" data-type="day" data-name="Rustdag met Meting" data-icon="fas fa-bed" data-content='[{"type":"rest-day","name":"Rustdag","icon":"fas fa-bed","zoneColor":"text-gray-500","topPosition":0},{"type":"rest-measurement-base","name":"Rustmeting (Basis)","icon":"fas fa-heart-circle-bolt","zoneColor":"text-emerald-400","topPosition":50}]'>
                        <span><i class="fas fa-bed mr-2 text-gray-300"></i>Rustdag met Meting</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>

                    <h4 class="text-md font-semibold mt-4 mb-2 text-gray-300">Coördinatie Schema's</h4>
                    <div class="drag-item" draggable="true" data-type="day" data-name="Basis Coördinatie Dag" data-icon="fas fa-balance-scale" data-content='[{"type":"coordination-activity","name":"Balansoefeningen","icon":"fas fa-balance-scale","zoneColor":"text-teal-400","inputType":"time","duration":20,"notes":"Eenvoudige balansoefeningen","topPosition":0}]'>
                        <span><i class="fas fa-balance-scale mr-2 text-teal-300"></i>Basis Coördinatie Dag</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>

                    <h4 class="text-md font-semibold mt-4 mb-2 text-gray-300">Flexibiliteit Schema's</h4>
                    <div class="drag-item" draggable="true" data-type="day" data-name="Flexibiliteit Sessie" data-icon="fas fa-child-reaching" data-content='[{"type":"flexibility-activity","name":"Dynamisch Rekken","icon":"fas fa-child-reaching","zoneColor":"text-rose-400","inputType":"time","duration":25,"notes":"Voor warming-up","topPosition":0},{"type":"flexibility-activity","name":"Yoga Sessie","icon":"fas fa-om","zoneColor":"text-amber-400","inputType":"time","duration":45,"notes":"Focus op lenigheid","topPosition":50}]'>
                        <span><i class="fas fa-child-reaching mr-2 text-fuchsia-300"></i>Flexibiliteit Sessie</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>

                    <h4 class="text-md font-semibold mt-4 mb-2 text-gray-300">Snelheid Schema's</h4>
                    <div class="drag-item" draggable="true" data-type="day" data-name="Sprint Dag" data-icon="fas fa-running" data-content='[{"type":"speed-activity","name":"Sprinttraining","icon":"fas fa-running","zoneColor":"text-red-500","inputType":"reps_sets","reps":10,"sets":5,"notes":"Korte, maximale sprints","topPosition":0}]'>
                        <span><i class="fas fa-running mr-2 text-red-300"></i>Sprint Dag</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>

                    <h4 class="text-md font-semibold mt-4 mb-2 text-gray-300">Voeding Schema's</h4>
                    <div class="drag-item" draggable="true" data-type="day" data-name="Voedingsplan Dag" data-icon="fas fa-utensils" data-content='[{"type":"nutrition-activity","name":"Maaltijdplan","icon":"fas fa-utensils","zoneColor":"text-lime-300","duration":null,"notes":"Volg gepersonaliseerd maaltijdplan","topPosition":0},{"type":"nutrition-activity","name":"Hydratatie Doel","icon":"fas fa-water","zoneColor":"text-blue-300","duration":null,"notes":"Drink 3 liter water","topPosition":50}]'>
                        <span><i class="fas fa-utensils mr-2 text-lime-300"></i>Voedingsplan Dag</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                </div>


                <!-- Aangepaste Metingen (worden dynamisch toegevoegd) -->
                <h3 class="text-lg font-bold mt-6 mb-2 text-gray-100">Aangepaste Metingen</h3>
                <div id="custom-measurements-list">
                    <p class="text-gray-400 text-sm">Geen aangepaste metingen.</p>
                </div>

                <!-- Knoppen om een nieuwe dag, week, maand te maken die gesleept kan worden -->
                <button id="create-day-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200 w-full mt-4">
                    <i class="fas fa-plus mr-2"></i>Maak Nieuwe Dag
                </button>
                <button id="create-week-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200 w-full mt-2">
                    <i class="fas fa-plus mr-2"></i>Maak Nieuwe Week
                </button>
                <button id="create-block-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200 w-full mt-2">
                    <i class="fas fa-plus mr-2"></i>Maak Nieuw Blok
                </button>
            </div>
        </div>

        <!-- Hoofdinhoud: Tabbladen en Werkgebied -->
        <div class="main-content">
            <h1 class="text-2xl font-bold mb-4 text-gray-100">Cardio Schemabouwer</h1>
            <button id="settings-btn" class="settings-icon-btn" title="Instellingen"><i class="fas fa-cog"></i></button>

            <!-- Tab Navigatie -->
            <div class="flex border-b border-gray-700 mb-4">
                <button class="tab-button active" data-tab="dag">Dag</button>
                <button class="tab-button" data-tab="week">Week</button>
                <button class="tab-button" data-tab="blok">Blok</button>
                <button class="tab-button" data-tab="form-builder">Form Builder</button>
            </div>

            <!-- Tab Inhoud: Dag -->
            <div id="tab-dag" class="tab-content active">
                <h2 class="text-xl font-bold mb-2 text-gray-100">Configureer Dag</h2>
                <input type="text" id="current-day-name" placeholder="Naam van deze dag (bijv. Maandag Intensief)" class="p-2 rounded-md bg-gray-700 border border-gray-600 text-gray-200 w-full mb-4">
                <div class="day-timeline-container">
                    <div class="time-labels" id="day-time-labels">
                        <!-- Tijdlabels worden hier dynamisch gegenereerd -->
                    </div>
                    <div id="day-drop-zone" class="day-drop-zone-content drop-zone">
                        <p class="text-gray-400 text-center">Sleep hartslagzones, rust, metingen of documenten hierheen om de dag te configureren.</p>
                    </div>
                </div>
                <button id="save-day-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200 w-full mt-4">
                    <i class="fas fa-save mr-2"></i>Sla Dag op
                </button>
                <h3 class="text-lg font-bold mt-6 mb-2 text-gray-100">Opgeslagen Dagen</h3>
                <div id="saved-days-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <p class="text-gray-400 col-span-full">Nog geen dagen opgeslagen.</p>
                </div>
            </div>

            <!-- Tab Inhoud: Week -->
            <div id="tab-week" class="tab-content">
                <h2 class="text-xl font-bold mb-2 text-gray-100">Configureer Week</h2>
                <input type="text" id="current-week-name" placeholder="Naam van deze week (bijv. Week 1 Piektraining)" class="p-2 rounded-md bg-gray-700 border border-gray-600 text-gray-200 w-full mb-4">
                <div class="calendar-grid">
                    <div class="calendar-day-cell">
                        <h3>Maandag</h3>
                        <div class="drop-zone day-slot" data-day-of-week="Maandag">
                            <p class="text-gray-400 text-center text-sm">Sleep dag hier</p>
                        </div>
                    </div>
                    <div class="calendar-day-cell">
                        <h3>Dinsdag</h3>
                        <div class="drop-zone day-slot" data-day-of-week="Dinsdag">
                            <p class="text-gray-400 text-center text-sm">Sleep dag hier</p>
                        </div>
                    </div>
                    <div class="calendar-day-cell">
                        <h3>Woensdag</h3>
                        <div class="drop-zone day-slot" data-day-of-week="Woensdag">
                            <p class="text-gray-400 text-center text-sm">Sleep dag hier</p>
                        </div>
                    </div>
                    <div class="calendar-day-cell">
                        <h3>Donderdag</h3>
                        <div class="drop-zone day-slot" data-day-of-week="Donderdag">
                            <p class="text-gray-400 text-center text-sm">Sleep dag hier</p>
                        </div>
                    </div>
                    <div class="calendar-day-cell">
                        <h3>Vrijdag</h3>
                        <div class="drop-zone day-slot" data-day-of-week="Vrijdag">
                            <p class="text-gray-400 text-center text-sm">Sleep dag hier</p>
                        </div>
                    </div>
                    <div class="calendar-day-cell">
                        <h3>Zaterdag</h3>
                        <div class="drop-zone day-slot" data-day-of-week="Zaterdag">
                            <p class="text-gray-400 text-center text-sm">Sleep dag hier</p>
                        </div>
                    </div>
                    <div class="calendar-day-cell">
                        <h3>Zondag</h3>
                        <div class="drop-zone day-slot" data-day-of-week="Zondag">
                            <p class="text-gray-400 text-center text-sm">Sleep dag hier</p>
                        </div>
                    </div>
                </div>
                <button id="save-week-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200 w-full mt-4">
                    <i class="fas fa-save mr-2"></i>Sla Week op
                </button>
                <h3 class="text-lg font-bold mt-6 mb-2 text-gray-100">Opgeslagen Weken</h3>
                <div id="saved-weeks-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <p class="text-gray-400 col-span-full">Nog geen weken opgeslagen.</p>
                </div>
            </div>

            <!-- Tab Inhoud: Blok -->
            <div id="tab-blok" class="tab-content">
                <h2 class="text-xl font-bold mb-2 text-gray-100">Configureer Blok</h2>
                <input type="text" id="current-blok-name" placeholder="Naam van dit blok (bijv. Voorbereiding Marathon)" class="p-2 rounded-md bg-gray-700 border border-gray-600 text-gray-200 w-full mb-4">
                <div id="blok-drop-zone" class="drop-zone">
                    <p class="text-gray-400 text-center">Sleep weken hierheen om het blok te configureren.</p>
                </div>
                <button id="save-blok-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200 w-full mt-4">
                    <i class="fas fa-save mr-2"></i>Sla Blok op
                </button>
                <h3 class="text-lg font-bold mt-6 mb-2 text-gray-100">Opgeslagen Blokken</h3>
                <div id="saved-bloks-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <p class="text-gray-400 col-span-full">Nog geen blokken opgeslagen.</p>
                </div>
            </div>

            <!-- Tab Inhoud: Form Builder -->
            <div id="tab-form-builder" class="tab-content">
                <h2 class="text-xl font-bold mb-2 text-gray-100">Form Builder: Aangepaste Metingen</h2>

                <!-- Aangepaste Training Meting Bouwer -->
                <div class="bg-gray-700 p-4 rounded-lg mb-6">
                    <h3 class="text-lg font-bold mb-2 text-gray-100">Nieuwe Aangepaste Training Meting</h3>
                    <input type="text" id="custom-training-name" placeholder="Naam training meting (bijv. HIIT 30/30)" class="p-2 rounded-md bg-gray-800 border border-gray-600 text-gray-200 w-full mb-2">
                    <div id="custom-training-zones-drop-zone" class="drop-zone !min-h-[80px] !mt-2">
                        <p class="text-gray-400 text-center text-sm">Sleep HR zones hierheen om de training te definiëren.</p>
                    </div>
                    <button id="save-custom-training-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200 w-full mt-4">
                        <i class="fas fa-plus mr-2"></i>Sla Aangepaste Training op
                    </button>
                </div>

                <!-- Aangepaste Rust Meting Bouwer -->
                <div class="bg-gray-700 p-4 rounded-lg">
                    <h3 class="text-lg font-bold mb-2 text-gray-100">Nieuwe Aangepaste Rust Meting</h3>
                    <input type="text" id="custom-rest-name" placeholder="Naam rust meting (bijv. Ochtend HRV Check)" class="p-2 rounded-md bg-gray-800 border border-gray-600 text-gray-200 w-full mb-2">
                    <textarea id="custom-rest-description" placeholder="Beschrijving" rows="2" class="p-2 rounded-md bg-gray-800 border border-gray-600 text-gray-200 w-full mb-2"></textarea>
                    <textarea id="custom-rest-goals" placeholder="Doelen/Formules (bijv. RMSSD > 50, Ti/Te ratio 1.2)" rows="3" class="p-2 rounded-md bg-gray-800 border border-gray-600 text-gray-200 w-full mb-2"></textarea>
                    <button id="save-custom-rest-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200 w-full mt-4">
                        <i class="fas fa-plus mr-2"></i>Sla Aangepaste Rust op
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Message Box voor notificaties -->
    <div id="message-box" class="message-box"></div>

    <script>
        // Functie om een unieke ID te genereren
        function generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substring(2);
        }

        // Functie om een bericht te tonen
        function showMessage(message, type = 'info') {
            const msgBox = document.getElementById('message-box');
            msgBox.textContent = message;
            msgBox.className = `message-box show bg-${type === 'error' ? 'red' : type === 'success' ? 'green' : 'gray'}-700`;
            setTimeout(() => {
                msgBox.classList.remove('show');
            }, 3000);
        }

        // --- Tab Navigatie Logica ---
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', () => {
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

                button.classList.add('active');
                document.getElementById(`tab-${button.dataset.tab}`).classList.add('active');

                // Laad opgeslagen items wanneer van tabblad wordt gewisseld
                loadSavedDays();
                loadSavedWeeks();
                loadSavedBloks();
                loadCustomMeasurements(); // Laad aangepaste metingen als we naar Form Builder gaan
            });
        });

        // --- Drag & Drop Logica ---
        let draggedItemData = null; // Slaat de data van het gesleepte item op

        document.querySelectorAll('.drag-item').forEach(item => {
            item.addEventListener('dragstart', (e) => {
                draggedItemData = {
                    type: e.target.dataset.type,
                    name: e.target.dataset.name,
                    icon: e.target.dataset.icon,
                    id: e.target.dataset.id || generateUniqueId(), // Gebruik bestaande ID of genereer een nieuwe
                    content: e.target.dataset.content ? JSON.parse(e.target.dataset.content) : null, // Voor geneste items
                    zoneColor: e.target.dataset.zoneColor || '', // Voor HR zone kleur
                    duration: e.target.dataset.duration || null, // Voor initiële duur bij kopiëren
                    progressionEnabled: e.target.dataset.progressionEnabled === 'true', // Voor initiële progressie bij kopiëren
                    progressionValue: e.target.dataset.progressionValue || null, // Voor initiële progressie waarde bij kopiëren
                    // Specifiek voor aangepaste metingen
                    customMeasurementType: e.target.dataset.customMeasurementType || null,
                    customMeasurementDefinition: e.target.dataset.customMeasurementDefinition ? JSON.parse(e.target.dataset.customMeasurementDefinition) : null,
                    customMeasurementDescription: e.target.dataset.customMeasurementDescription || null,
                    customMeasurementGoals: e.target.dataset.customMeasurementGoals || null
                };
                e.dataTransfer.setData('text/plain', JSON.stringify(draggedItemData));
                e.dataTransfer.effectAllowed = 'move';
            });
        });

        document.querySelectorAll('.drop-zone').forEach(zone => {
            zone.addEventListener('dragover', (e) => {
                e.preventDefault(); 
                zone.classList.add('drag-over');
                e.dataTransfer.dropEffect = 'move';
            });

            zone.addEventListener('dragleave', (e) => {
                zone.classList.remove('drag-over');
            });

            zone.addEventListener('drop', (e) => {
                e.preventDefault();
                zone.classList.remove('drag-over');

                const data = JSON.parse(e.dataTransfer.getData('text/plain'));
                const dropZoneId = zone.id; 
                const dropZoneClasses = zone.classList; 

                // Validatie van drop-actie
                let isValidDrop = false;
                let expectedTypes = [];

                if (dropZoneId === 'day-drop-zone') { 
                    expectedTypes = ['hr-zone', 'rest-day', 'training-measurement', 'rest-measurement-free', 'rest-measurement-base', 'document-link', 'custom-training-measurement', 'custom-rest-measurement'];
                    if (expectedTypes.includes(data.type)) {
                        isValidDrop = true;
                    }
                } else if (dropZoneClasses.contains('day-slot')) {
                    expectedTypes = ['day'];
                    if (data.type === 'day') {
                        isValidDrop = true;
                    }
                } else if (dropZoneClasses.contains('week-slot')) {
                    expectedTypes = ['week'];
                    if (data.type === 'week') {
                        isValidDrop = true;
                    }
                } else if (dropZoneId === 'blok-drop-zone') {
                    expectedTypes = ['week'];
                    if (data.type === 'week') { 
                        isValidDrop = true;
                    }
                } else if (dropZoneId === 'custom-training-zones-drop-zone') { 
                    expectedTypes = ['hr-zone'];
                    if (data.type === 'hr-zone') {
                        isValidDrop = true;
                    }
                }

                if (!isValidDrop) {
                    let specificMessage = `Kan '${data.name}' (type: ${data.type}) niet slepen naar deze zone.`;
                    if (expectedTypes.length > 0) {
                        specificMessage += ` Deze zone accepteert alleen: ${expectedTypes.map(t => t.replace(/-/g, ' ')).join(', ')}.`;
                    }
                    showMessage(specificMessage, 'error');
                    console.error("Ongeldige drop poging:", { draggedType: data.type, targetId: dropZoneId, targetClasses: Array.from(dropZoneClasses) });
                    return;
                }

                // Verwijder placeholder tekst indien aanwezig
                const placeholder = zone.querySelector('p.text-gray-400');
                if (placeholder) {
                    placeholder.remove();
                }

                // Maak het gedropte item aan
                const droppedItem = document.createElement('div');
                droppedItem.dataset.id = data.id;
                droppedItem.dataset.type = data.type;
                droppedItem.dataset.name = data.name;
                if (data.content) {
                    droppedItem.dataset.content = JSON.stringify(data.content);
                }
                if (data.zoneColor) droppedItem.dataset.zoneColor = data.zoneColor;
                if (data.documentName) droppedItem.dataset.documentName = data.documentName;
                if (data.customMeasurementType) droppedItem.dataset.customMeasurementType = data.customMeasurementType;
                if (data.customMeasurementDefinition) droppedItem.dataset.customMeasurementDefinition = JSON.stringify(data.customMeasurementDefinition);
                if (data.customMeasurementDescription) droppedItem.dataset.customMeasurementDescription = data.customMeasurementDescription;
                if (data.customMeasurementGoals) droppedItem.dataset.customMeasurementGoals = data.customMeasurementGoals;


                let innerHtmlContent = `<span><i class="${data.icon} mr-2 ${data.zoneColor || ''}"></i>${data.name}</span>`;
                
                if (dropZoneId === 'day-drop-zone') { // Items gesleept naar de Dag tijdlijn
                    droppedItem.className = `timeline-item flex items-center p-2 mb-1 rounded-md bg-gray-700`;
                    
                    const rect = zone.getBoundingClientRect();
                    const relativeY = e.clientY - rect.top;
                    droppedItem.style.top = `${relativeY}px`;
                    droppedItem.style.left = '0';
                    droppedItem.style.width = '100%';
                    droppedItem.style.position = 'absolute';

                    if (data.type === 'hr-zone') {
                        innerHtmlContent += `
                            <div class="flex items-center space-x-2 ml-auto">
                                <input type="number" placeholder="Minuten" class="w-20 p-1 rounded-md bg-gray-800 border border-gray-600 text-gray-200 text-sm" data-duration-input value="${data.duration || ''}">
                                <label class="flex items-center text-sm text-gray-300">
                                    <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500" data-progression-checkbox ${data.progressionEnabled ? 'checked' : ''}>
                                    <span class="ml-1">Wekelijks toenemen?</span>
                                </label>
                                <input type="number" placeholder="Minuten" class="w-16 p-1 rounded-md bg-gray-800 border border-gray-600 text-gray-200 text-sm" data-progression-value-input value="${data.progressionValue || ''}" ${!data.progressionEnabled ? 'disabled' : ''}>
                            </div>
                        `;
                        droppedItem.classList.add('hr-zone-bar');
                    } else if (data.type === 'document-link') {
                        if (!data.documentName) { 
                            const docName = prompt('Voer de naam/ID van het document in:');
                            data.documentName = docName || 'Onbekend Document';
                        }
                        droppedItem.dataset.documentName = data.documentName;
                        innerHtmlContent += `<span class="ml-2 text-gray-400">(${data.documentName})</span>`;
                    } else if (data.type === 'custom-training-measurement' && data.customMeasurementDefinition) {
                        const totalDuration = data.customMeasurementDefinition.reduce((sum, item) => sum + (item.duration || 0), 0);
                        innerHtmlContent += `<span class="ml-2 text-gray-400">(${totalDuration} min)</span>`;
                    } else if (data.type === 'custom-rest-measurement' && data.customMeasurementDescription) {
                         innerHtmlContent += `<span class="ml-2 text-gray-400">(${data.customMeasurementDescription.substring(0, 20)}...)</span>`;
                    }
                    innerHtmlContent += `<button class="remove-btn"><i class="fas fa-times"></i></button>`;
                    droppedItem.innerHTML = innerHtmlContent;
                    zone.appendChild(droppedItem);

                    if (data.type === 'hr-zone') {
                        const progressionCheckbox = droppedItem.querySelector('[data-progression-checkbox]');
                        const progressionValueInput = droppedItem.querySelector('[data-progression-value-input]');
                        if (progressionCheckbox && progressionValueInput) {
                            progressionCheckbox.addEventListener('change', () => {
                                progressionValueInput.disabled = !progressionCheckbox.checked;
                                if (!progressionCheckbox.checked) {
                                    progressionValueInput.value = '';
                                }
                            });
                        }
                    }

                } else if (dropZoneId === 'custom-training-zones-drop-zone') { // Items gesleept naar Custom Training Builder
                     droppedItem.className = 'dropped-item flex items-center p-2 mb-1 rounded-md bg-gray-700';
                     innerHtmlContent += `
                        <div class="flex items-center space-x-2 ml-auto">
                            <input type="number" placeholder="Minuten" class="w-20 p-1 rounded-md bg-gray-800 border border-gray-600 text-gray-200 text-sm" data-duration-input value="${data.duration || ''}">
                        </div>
                    `;
                    innerHtmlContent += `<button class="remove-btn"><i class="fas fa-times"></i></button>`;
                    droppedItem.innerHTML = innerHtmlContent;
                    zone.appendChild(droppedItem);

                } else { // Voor week-slot, blok-drop-zone (niet-tijdlijn weergaven)
                    droppedItem.className = 'dropped-item flex items-center justify-between p-2 mb-2 rounded-md bg-gray-700';
                    if (data.type === 'week' && dropZoneId === 'blok-drop-zone') { // Alleen voor weken in blok
                        innerHtmlContent += `
                            <div class="flex items-center space-x-2 ml-auto">
                                <span class="text-sm text-gray-300">Herhalingen:</span>
                                <input type="number" value="1" min="1" class="w-16 p-1 rounded-md bg-gray-800 border border-gray-600 text-gray-200 text-sm" data-repetitions-input>
                            </div>
                        `;
                    }
                    innerHtmlContent += `<button class="remove-btn"><i class="fas fa-times"></i></button>`;
                    droppedItem.innerHTML = innerHtmlContent;
                    zone.innerHTML = ''; 
                    zone.appendChild(droppedItem);
                }
                
                // Voeg event listener toe voor verwijderen (voor alle dropped items)
                droppedItem.querySelector('.remove-btn').addEventListener('click', () => {
                    droppedItem.remove();
                    // Voeg placeholder terug als de zone leeg is
                    if (zone.children.length === 0) {
                        const newPlaceholder = document.createElement('p');
                        newPlaceholder.className = 'text-gray-400 text-center text-sm';
                        if (dropZoneId === 'day-drop-zone' || dropZoneId === 'custom-training-zones-drop-zone') { 
                            newPlaceholder.textContent = 'Sleep hartslagzones, rust, metingen of documenten hierheen om de training te configureren.';
                        } else if (dropZoneClasses.contains('day-slot')) {
                            newPlaceholder.textContent = 'Sleep dag hier';
                        } else if (dropZoneClasses.contains('week-slot')) {
                            newPlaceholder.textContent = 'Sleep week hier';
                        } else if (dropZoneId === 'blok-drop-zone') {
                            newPlaceholder.textContent = 'Sleep weken hierheen om het blok te configureren.';
                        }
                        zone.appendChild(newPlaceholder);
                    }
                });

                showMessage(`${data.name} toegevoegd!`, 'success');
            });
        });

        // --- Hulpfunctie om dropzones te vullen bij kopiëren en laden ---
        function populateDropZone(dropZoneElement, contentData, targetType) {
            dropZoneElement.innerHTML = ''; // Maak de dropzone leeg
            if (!contentData || (Array.isArray(contentData) && contentData.length === 0 && dropZoneElement.id !== 'blok-drop-zone')) { // targetType 'object' is for week/month slots
                 const newPlaceholder = document.createElement('p');
                 newPlaceholder.className = 'text-gray-400 text-center text-sm';
                 if (dropZoneElement.id === 'day-drop-zone' || dropZoneElement.id === 'custom-training-zones-drop-zone') {
                    newPlaceholder.textContent = 'Sleep hartslagzones, rust, metingen of documenten hierheen om de dag te configureren.';
                 } else if (dropZoneElement.classList.contains('day-slot')) {
                    newPlaceholder.textContent = 'Sleep dag hier';
                 } else if (dropZoneElement.classList.contains('week-slot')) {
                    newPlaceholder.textContent = 'Sleep week hier';
                 } else if (dropZoneElement.id === 'blok-drop-zone') {
                    newPlaceholder.textContent = 'Sleep weken hierheen om het blok te configureren.';
                 }
                 dropZoneElement.appendChild(newPlaceholder);
                 return;
            }

            if (Array.isArray(contentData)) { // Voor Dag (array van activiteiten) of Custom Training (array van zones)
                contentData.forEach(item => {
                    const droppedItem = document.createElement('div');
                    droppedItem.dataset.id = item.id || generateUniqueId();
                    droppedItem.dataset.type = item.type;
                    droppedItem.dataset.name = item.name;
                    droppedItem.dataset.icon = item.icon;
                    if (item.zoneColor) droppedItem.dataset.zoneColor = item.zoneColor;
                    if (item.content) droppedItem.dataset.content = JSON.stringify(item.content); 
                    if (item.documentName) droppedItem.dataset.documentName = item.documentName;
                    if (item.customMeasurementType) droppedItem.dataset.customMeasurementType = item.customMeasurementType;
                    if (item.customMeasurementDefinition) droppedItem.dataset.customMeasurementDefinition = JSON.stringify(item.customMeasurementDefinition);
                    if (item.customMeasurementDescription) droppedItem.dataset.customMeasurementDescription = item.customMeasurementDescription;
                    if (item.customMeasurementGoals) droppedItem.dataset.customMeasurementGoals = item.customMeasurementGoals;


                    let innerHtmlContent = `<span><i class="${item.icon} mr-2 ${item.zoneColor || ''}"></i>${item.name}</span>`;
                    
                    if (item.type === 'hr-zone') {
                        droppedItem.className = `timeline-item flex items-center p-2 mb-1 rounded-md bg-gray-700 hr-zone-bar`;
                        innerHtmlContent += `
                            <div class="flex items-center space-x-2 ml-auto">
                                <input type="number" placeholder="Minuten" class="w-20 p-1 rounded-md bg-gray-800 border border-gray-600 text-gray-200 text-sm" data-duration-input value="${item.duration || ''}">
                                <label class="flex items-center text-sm text-gray-300">
                                    <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500" data-progression-checkbox ${item.progressionEnabled ? 'checked' : ''}>
                                    <span class="ml-1">Wekelijks toenemen?</span>
                                </label>
                                <input type="number" placeholder="Minuten" class="w-16 p-1 rounded-md bg-gray-800 border border-gray-600 text-gray-200 text-sm" data-progression-value-input value="${item.progressionValue || ''}" ${!item.progressionEnabled ? 'disabled' : ''}>
                            </div>
                        `;
                    } else {
                        droppedItem.className = 'timeline-item flex items-center p-2 mb-1 rounded-md bg-gray-700';
                        if (item.type === 'document-link') {
                            innerHtmlContent += `<span class="ml-2 text-gray-400">(${item.documentName || 'Onbekend Document'})</span>`;
                        } else if (item.type === 'custom-training-measurement') {
                            const totalDuration = item.customMeasurementDefinition ? item.customMeasurementDefinition.reduce((sum, subItem) => sum + (subItem.duration || 0), 0) : 0;
                            innerHtmlContent += `<span class="ml-2 text-gray-400">(${totalDuration} min)</span>`;
                        } else if (item.type === 'custom-rest-measurement') {
                            innerHtmlContent += `<span class="ml-2 text-gray-400">(${item.customMeasurementDescription ? item.customMeasurementDescription.substring(0, 20) + '...' : 'Geen beschrijving'})</span>`;
                        }
                    }
                    innerHtmlContent += `<button class="remove-btn"><i class="fas fa-times"></i></button>`;
                    droppedItem.innerHTML = innerHtmlContent;
                    
                    // Set position for loaded items in day-drop-zone
                    if (dropZoneElement.id === 'day-drop-zone') {
                        droppedItem.style.top = `${item.topPosition || 0}px`;
                        droppedItem.style.left = '0';
                        droppedItem.style.width = '100%';
                        droppedItem.style.position = 'absolute';
                    }

                    dropZoneElement.appendChild(droppedItem);

                    // Event listeners voor geladen items
                    if (item.type === 'hr-zone') {
                        const progressionCheckbox = droppedItem.querySelector('[data-progression-checkbox]');
                        const progressionValueInput = droppedItem.querySelector('[data-progression-value-input]');
                        if (progressionCheckbox && progressionValueInput) {
                            progressionCheckbox.addEventListener('change', () => {
                                progressionValueInput.disabled = !progressionCheckbox.checked;
                                if (!progressionCheckbox.checked) {
                                    progressionValueInput.value = '';
                                }
                            });
                        }
                    }
                    droppedItem.querySelector('.remove-btn').addEventListener('click', () => {
                        droppedItem.remove();
                        if (dropZoneElement.children.length === 0) {
                            const newPlaceholder = document.createElement('p');
                            newPlaceholder.className = 'text-gray-400 text-center text-sm';
                            newPlaceholder.textContent = 'Sleep hartslagzones, rust, metingen of documenten hierheen om de dag te configureren.';
                            dropZoneElement.appendChild(newPlaceholder);
                        }
                    });
                });
            } else if (contentData && typeof contentData === 'object' && targetType === 'object') { // Voor Week (object met dagen), Maand (object met weken)
                for (const key in contentData) {
                    const slot = dropZoneElement.querySelector(`[data-${dropZoneElement.classList.contains('day-slot') ? 'day-of-week' : 'week-number'}="${key}"]`);
                    if (slot) {
                        slot.innerHTML = ''; // Clear placeholder
                        if (contentData[key]) {
                            const item = contentData[key];
                            const droppedItem = document.createElement('div');
                            droppedItem.className = 'dropped-item flex flex-col p-2 mb-1 rounded-md bg-gray-700';
                            droppedItem.dataset.id = item.id;
                            droppedItem.dataset.type = item.type;
                            droppedItem.dataset.name = item.name;
                            droppedItem.dataset.icon = item.icon;
                            droppedItem.dataset.content = JSON.stringify(item.content); // Recursief voor geneste content

                            // Samenvatting voor dag/week in kalenderweergave
                            let summaryHtml = '';
                            if (item.type === 'day' && item.content && Array.isArray(item.content)) {
                                const hrZonesSummary = item.content.filter(act => act.type === 'hr-zone').map(hrz => `${hrz.name} (${hrz.duration} min)`).join(', ');
                                const otherActivities = item.content.filter(act => act.type !== 'hr-zone').map(act => act.name).join(', ');
                                summaryHtml = `<div class="text-xs text-gray-400 mt-1">${hrZonesSummary}${otherActivities ? (hrZonesSummary ? '; ' : '') + otherActivities : ''}</div>`;
                            } else if (item.type === 'week' && item.content && typeof item.content === 'object') {
                                const daysCount = Object.values(item.content).filter(d => d !== null).length;
                                summaryHtml = `<div class="text-xs text-gray-400 mt-1">${daysCount} dagen geconfigureerd</div>`;
                            }

                            droppedItem.innerHTML = `
                                <span><i class="${item.icon} mr-2"></i>${item.name}</span>
                                ${summaryHtml}
                                <button class="remove-btn absolute top-1 right-1"><i class="fas fa-times"></i></button>
                            `;
                            slot.appendChild(droppedItem);

                            droppedItem.querySelector('.remove-btn').addEventListener('click', () => {
                                droppedItem.remove();
                                const newPlaceholder = document.createElement('p');
                                newPlaceholder.className = 'text-gray-400 text-center text-sm';
                                newPlaceholder.textContent = slot.classList.contains('day-slot') ? 'Sleep dag hier' : 'Sleep week hier';
                                slot.appendChild(newPlaceholder);
                            });
                        } else {
                            const newPlaceholder = document.createElement('p');
                            newPlaceholder.className = 'text-gray-400 text-center text-sm';
                            newPlaceholder.textContent = slot.classList.contains('day-slot') ? 'Sleep dag hier' : 'Sleep week hier';
                            slot.appendChild(newPlaceholder);
                        }
                    }
                }
            } else if (dropZoneElement.id === 'blok-drop-zone') { // Voor Blok (array van maanden)
                 if (contentData.length === 0) {
                     const newPlaceholder = document.createElement('p');
                     newPlaceholder.className = 'text-gray-400 text-center';
                     newPlaceholder.textContent = 'Sleep weken hierheen om het blok te configureren.';
                     dropZoneElement.appendChild(newPlaceholder);
                     return;
                }
                contentData.forEach(item => {
                    const droppedItem = document.createElement('div');
                    droppedItem.className = 'dropped-item flex flex-col p-3 rounded-md bg-gray-700';
                    droppedItem.dataset.id = item.id;
                    droppedItem.dataset.type = item.type;
                    droppedItem.dataset.name = item.name;
                    droppedItem.dataset.icon = item.icon;
                    droppedItem.dataset.content = JSON.stringify(item.content);
                    if (item.repetitions) droppedItem.dataset.repetitions = item.repetitions; // Load repetitions

                    droppedItem.innerHTML = `
                        <div class="flex items-center justify-between w-full">
                            <span><i class="${item.icon} mr-2 text-cyan-300"></i>${item.name}</span>
                            <div class="flex items-center space-x-2 ml-auto">
                                <span class="text-sm text-gray-300">Herhalingen:</span>
                                <input type="number" value="${item.repetitions || 1}" min="1" class="w-16 p-1 rounded-md bg-gray-800 border border-gray-600 text-gray-200 text-sm" data-repetitions-input>
                            </div>
                            <button class="remove-btn"><i class="fas fa-times"></i></button>
                        </div>
                        <div class="text-xs text-gray-300 mt-2">
                            ${Object.keys(item.content).filter(day => item.content[day]).map(day => `<span class="inline-block bg-gray-800 rounded-full px-2 py-1 text-xs font-semibold text-gray-300 mr-1 mb-1">${item.content[day].name}</span>`).join('')}
                        </div>
                    `;
                    dropZoneElement.appendChild(droppedItem);

                    droppedItem.querySelector('.remove-btn').addEventListener('click', () => {
                        droppedItem.remove();
                        if (dropZoneElement.children.length === 0) {
                            const newPlaceholder = document.createElement('p');
                            newPlaceholder.className = 'text-gray-400 text-center';
                            newPlaceholder.textContent = 'Sleep weken hierheen om het blok te configureren.';
                            dropZoneElement.appendChild(newPlaceholder);
                        }
                    });
                });
            }
        }


        // --- Opslaan en Laden van Schema's (via localStorage) ---

        // Dagen
        const currentDayNameInput = document.getElementById('current-day-name');
        const dayDropZone = document.getElementById('day-drop-zone'); // Correcte ID
        const saveDayBtn = document.getElementById('save-day-btn');
        const savedDaysList = document.getElementById('saved-days-list');

        saveDayBtn.addEventListener('click', () => {
            const dayName = currentDayNameInput.value.trim();
            if (!dayName) {
                showMessage('Geef de dag een naam.', 'error');
                return;
            }

            const activities = [];
            let hasError = false; 
            dayDropZone.querySelectorAll('.timeline-item').forEach(item => {
                const activity = {
                    type: item.dataset.type,
                    name: item.dataset.name,
                    icon: item.querySelector('i').className,
                    zoneColor: item.dataset.zoneColor || '',
                    topPosition: parseFloat(item.style.top) || 0 
                };
                if (item.dataset.type === 'hr-zone') {
                    const durationInput = item.querySelector('[data-duration-input]');
                    const progressionCheckbox = item.querySelector('[data-progression-checkbox]');
                    const progressionValueInput = item.querySelector('[data-progression-value-input]');

                    const duration = parseInt(durationInput.value);
                    if (isNaN(duration) || duration <= 0) {
                        hasError = true;
                        showMessage('Vul een geldige duur (in minuten) in voor alle hartslagzones.', 'error');
                        return; 
                    }
                    activity.duration = duration;
                    activity.progressionEnabled = progressionCheckbox.checked;
                    activity.progressionValue = progressionCheckbox.checked ? parseInt(progressionValueInput.value) : null; 
                    if (activity.progressionEnabled && (isNaN(activity.progressionValue) || activity.progressionValue <= 0)) {
                        hasError = true;
                        showMessage('Vul een geldige toename waarde (in minuten) in voor wekelijkse toename.', 'error');
                        return;
                    }
                } else if (item.dataset.type === 'document-link') {
                    activity.documentName = item.dataset.documentName;
                } else if (item.dataset.type === 'custom-training-measurement') {
                    activity.customMeasurementType = item.dataset.customMeasurementType;
                    activity.customMeasurementDefinition = JSON.parse(item.dataset.customMeasurementDefinition);
                } else if (item.dataset.type === 'custom-rest-measurement') {
                    activity.customMeasurementType = item.dataset.customMeasurementType;
                    activity.customMeasurementDescription = item.dataset.customMeasurementDescription;
                    activity.customMeasurementGoals = item.dataset.customMeasurementGoals;
                }
                activities.push(activity);
            });

            if (hasError) {
                return; 
            }

            if (activities.length === 0) {
                showMessage('Voeg activiteiten toe aan de dag.', 'error');
                return;
            }

            activities.sort((a, b) => a.topPosition - b.topPosition);

            const dayId = generateUniqueId();
            const newDay = { id: dayId, name: dayName, activities: activities };

            let savedDays = JSON.parse(localStorage.getItem('cardioDays') || '[]');
            savedDays.push(newDay);
            localStorage.setItem('cardioDays', JSON.stringify(savedDays));

            showMessage('Dag opgeslagen!', 'success');
            currentDayNameInput.value = '';
            dayDropZone.innerHTML = '<p class="text-gray-400 text-center">Sleep hartslagzones, rust, metingen of documenten hierheen om de dag te configureren.</p>';
            loadSavedDays(); 
        });

        function loadSavedDays() {
            savedDaysList.innerHTML = '';
            const savedDays = JSON.parse(localStorage.getItem('cardioDays') || '[]');
            if (savedDays.length === 0) {
                savedDaysList.innerHTML = '<p class="text-gray-400 col-span-full">Nog geen dagen opgeslagen.</p>';
                return;
            }

            savedDays.forEach(day => {
                const dayCard = document.createElement('div');
                dayCard.className = 'drag-item bg-gray-600 p-3 rounded-md shadow flex flex-col cursor-grab';
                dayCard.setAttribute('draggable', 'true');
                dayCard.dataset.type = 'day';
                dayCard.dataset.id = day.id;
                dayCard.dataset.name = day.name;
                dayCard.dataset.icon = 'fas fa-calendar-day'; 
                dayCard.dataset.content = JSON.stringify(day.activities); 

                dayCard.innerHTML = `
                    <div class="flex items-center justify-between w-full">
                        <span><i class="${dayCard.dataset.icon} mr-2 text-blue-300"></i>${day.name}</span>
                        <button class="remove-saved-item-btn text-red-400 hover:text-red-300" data-id="${day.id}" data-list="cardioDays"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="text-xs text-gray-300 mt-2">
                        ${day.activities.map(act => {
                            let activityText = `<span class="inline-block bg-gray-800 rounded-full px-2 py-1 text-xs font-semibold text-gray-300 mr-1 mb-1"><i class="${act.icon.split(' ')[1]} mr-1 ${act.zoneColor || ''}"></i>${act.name}`;
                            if (act.type === 'hr-zone') {
                                if (act.duration) {
                                    activityText += ` (${act.duration} min)`;
                                }
                                if (act.progressionEnabled && act.progressionValue) {
                                    activityText += ` (+${act.progressionValue} min)`; 
                                }
                            } else if (act.type === 'document-link') {
                                activityText += ` (${act.documentName || 'Onbekend'})`;
                            } else if (act.type === 'custom-training-measurement') {
                                const totalDuration = act.customMeasurementDefinition ? act.customMeasurementDefinition.reduce((sum, subItem) => sum + (subItem.duration || 0), 0) : 0;
                                activityText += ` (${totalDuration} min)`;
                            } else if (act.type === 'custom-rest-measurement') {
                                activityText += ` (Aangepaste Rust)`;
                            }
                            activityText += `</span>`;
                            return activityText;
                        }).join('')}
                    </div>
                `;
                savedDaysList.appendChild(dayCard);
            });
            addRemoveListenersToSavedItems();
        }

        // Weken
        const currentWeekNameInput = document.getElementById('current-week-name');
        const weekDaySlots = document.querySelectorAll('.day-slot'); 
        const saveWeekBtn = document.getElementById('save-week-btn');
        const savedWeeksList = document.getElementById('saved-weeks-list');

        saveWeekBtn.addEventListener('click', () => {
            const weekName = currentWeekNameInput.value.trim();
            if (!weekName) {
                showMessage('Geef de week een naam.', 'error');
                return;
            }

            const daysInWeek = {};
            let isEmptyWeek = true;
            weekDaySlots.forEach(slot => {
                const dayOfWeek = slot.dataset.dayOfWeek;
                const droppedDay = slot.querySelector('.dropped-item');
                if (droppedDay) {
                    daysInWeek[dayOfWeek] = {
                        id: droppedDay.dataset.id,
                        name: droppedDay.dataset.name,
                        icon: droppedDay.dataset.icon,
                        content: JSON.parse(droppedDay.dataset.content)
                    };
                    isEmptyWeek = false;
                } else {
                    daysInWeek[dayOfWeek] = null; 
                }
            });

            if (isEmptyWeek) {
                showMessage('Voeg dagen toe aan de week.', 'error');
                return;
            }

            const weekId = generateUniqueId();
            const newWeek = { id: weekId, name: weekName, days: daysInWeek };

            let savedWeeks = JSON.parse(localStorage.getItem('cardioWeeks') || '[]');
            savedWeeks.push(newWeek);
            localStorage.setItem('cardioWeeks', JSON.stringify(savedWeeks));

            showMessage('Week opgeslagen!', 'success');
            currentWeekNameInput.value = '';
            weekDaySlots.forEach(slot => {
                slot.innerHTML = '<p class="text-gray-400 text-center text-sm">Sleep dag hier</p>';
            });
            loadSavedWeeks();
        });

        function loadSavedWeeks() {
            savedWeeksList.innerHTML = '';
            const savedWeeks = JSON.parse(localStorage.getItem('cardioWeeks') || '[]');
            if (savedWeeks.length === 0) {
                savedWeeksList.innerHTML = '<p class="text-gray-400 col-span-full">Nog geen weken opgeslagen.</p>';
                return;
            }

            savedWeeks.forEach(week => {
                const weekCard = document.createElement('div');
                weekCard.className = 'drag-item bg-gray-600 p-3 rounded-md shadow flex flex-col cursor-grab';
                weekCard.setAttribute('draggable', 'true');
                weekCard.dataset.type = 'week';
                weekCard.dataset.id = week.id;
                weekCard.dataset.name = week.name;
                weekCard.dataset.icon = 'fas fa-calendar-week'; 
                weekCard.dataset.content = JSON.stringify(week.days); 

                const configuredDays = Object.values(week.days).filter(day => day !== null).map(day => day.name);
                const summaryText = configuredDays.length > 0 ? configuredDays.join(', ') : 'Geen dagen geconfigureerd';

                weekCard.innerHTML = `
                    <div class="flex items-center justify-between w-full">
                        <span><i class="${weekCard.dataset.icon} mr-2 text-purple-300"></i>${week.name}</span>
                        <button class="remove-saved-item-btn text-red-400 hover:text-red-300" data-id="${week.id}" data-list="cardioWeeks"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="text-xs text-gray-300 mt-2">
                        ${summaryText}
                    </div>
                `;
                savedWeeksList.appendChild(weekCard);
            });
            addRemoveListenersToSavedItems();
        }

        // Blokken
        const currentBlokNameInput = document.getElementById('current-blok-name');
        const blokDropZone = document.getElementById('blok-drop-zone');
        const saveBlokBtn = document.getElementById('save-blok-btn');
        const savedBloksList = document.getElementById('saved-bloks-list');

        saveBlokBtn.addEventListener('click', () => {
            const blokName = currentBlokNameInput.value.trim();
            if (!blokName) {
                showMessage('Geef het blok een naam.', 'error');
                return;
            }

            const weeksInBlok = [];
            let hasError = false;
            blokDropZone.querySelectorAll('.dropped-item').forEach(item => {
                const repetitionsInput = item.querySelector('[data-repetitions-input]');
                const repetitions = parseInt(repetitionsInput.value);
                if (isNaN(repetitions) || repetitions <= 0) {
                    hasError = true;
                    showMessage('Vul een geldig aantal herhalingen in voor elke week.', 'error');
                    return;
                }

                weeksInBlok.push({
                    weekId: item.dataset.id,
                    name: item.dataset.name,
                    icon: item.dataset.icon,
                    content: JSON.parse(item.dataset.content), // Content is here the 'days' of the week
                    repetitions: repetitions
                });
            });

            if (hasError) {
                return;
            }

            if (weeksInBlok.length === 0) {
                showMessage('Voeg weken toe aan het blok.', 'error');
                return;
            }

            const blokId = generateUniqueId();
            const newBlok = { id: blokId, name: blokName, weeks: weeksInBlok }; // Blok bevat nu 'weeks' array

            let savedBloks = JSON.parse(localStorage.getItem('cardioBloks') || '[]');
            savedBloks.push(newBlok);
            localStorage.setItem('cardioBloks', JSON.stringify(savedBloks));

            showMessage('Blok opgeslagen!', 'success');
            currentBlokNameInput.value = '';
            blokDropZone.innerHTML = '<p class="text-gray-400 text-center">Sleep weken hierheen om het blok te configureren.</p>';
            loadSavedBloks();
        });

        function loadSavedBloks() {
            savedBloksList.innerHTML = '';
            const savedBloks = JSON.parse(localStorage.getItem('cardioBloks') || '[]');
            if (savedBloks.length === 0) {
                savedBloksList.innerHTML = '<p class="text-gray-400 col-span-full">Nog geen blokken opgeslagen.</p>';
                return;
            }

            savedBloks.forEach(blok => {
                const blokCard = document.createElement('div');
                blokCard.className = 'dropped-item flex flex-col p-3 rounded-md bg-gray-700'; 
                blokCard.dataset.id = blok.id;
                blokCard.dataset.name = blok.name;
                blokCard.dataset.type = 'blok'; // Add type for consistency

                const configuredWeeksSummary = blok.weeks.map(week => `${week.name} (${week.repetitions}x)`).join(', ');
                const summaryText = configuredWeeksSummary || 'Geen weken geconfigureerd';

                blokCard.innerHTML = `
                    <div class="flex items-center justify-between w-full">
                        <span><i class="fas fa-layer-group mr-2 text-cyan-300"></i>${blok.name}</span>
                        <button class="remove-saved-item-btn" data-id="${blok.id}" data-list="cardioBloks"><i class="fas fa-times"></i></button>
                    </div>
                    <div class="text-xs text-gray-300 mt-2">
                        ${summaryText}
                    </div>
                `;
                savedBloksList.appendChild(blokCard);
            });
            addRemoveListenersToSavedItems(); // Re-attach listeners for dynamically loaded items
        }

        // Functie voor het verwijderen van opgeslagen items (algemeen)
        function addRemoveListenersToSavedItems() {
            document.querySelectorAll('.remove-saved-item-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const idToRemove = e.target.closest('button').dataset.id;
                    const listName = e.target.closest('button').dataset.list;
                    
                    let savedItems = JSON.parse(localStorage.getItem(listName) || '[]');
                    savedItems = savedItems.filter(item => item.id !== idToRemove);
                    localStorage.setItem(listName, JSON.stringify(savedItems));
                    
                    showMessage('Item verwijderd!', 'info');
                    // Herlaad de juiste lijst
                    if (listName === 'cardioDays') loadSavedDays();
                    if (listName === 'cardioWeeks') loadSavedWeeks();
                    if (listName === 'cardioBloks') loadSavedBloks(); 
                    if (listName === 'customMeasurements') loadCustomMeasurements(); // Voor aangepaste metingen
                });
            });
        }

        // Initieel laden van opgeslagen items
        loadSavedDays();
        loadSavedWeeks();
        loadSavedBloks();
        loadCustomMeasurements(); // Laad aangepaste metingen bij start

        // --- Knoppen om nieuwe drag-items te maken (met kopieeroptie) ---
        function createNewItem(type, namePrompt, listName, icon, color) {
            const copyOption = confirm(`Wil je kopiëren van een bestaande ${type}?`);
            let itemName = '';
            let contentToCopy = (type === 'day' || type === 'custom-training-measurement') ? [] : {}; 

            if (copyOption) {
                const itemIdToCopy = prompt(`Voer de ID in van de ${type} die je wilt kopiëren:`);
                if (itemIdToCopy) {
                    const savedItems = JSON.parse(localStorage.getItem(`cardio${listName}`) || '[]');
                    const itemToCopy = savedItems.find(item => item.id === itemIdToCopy);
                    if (itemToCopy) {
                        itemName = prompt(`${namePrompt} (kopie van "${itemToCopy.name}"):`);
                        if (itemName) {
                            contentToCopy = JSON.parse(JSON.stringify(itemToCopy.activities || itemToCopy.days || itemToCopy.weeks || itemToCopy.customMeasurementDefinition));
                        }
                    } else {
                        showMessage(`${type} met opgegeven ID niet gevonden.`, 'error');
                        return;
                    }
                } else {
                    return; 
                }
            } else {
                itemName = prompt(namePrompt);
            }
            
            if (itemName) {
                const itemId = generateUniqueId();
                const newItemElement = document.createElement('div');
                newItemElement.className = 'drag-item';
                newItemElement.setAttribute('draggable', 'true');
                newItemElement.dataset.type = type;
                newItemElement.dataset.id = itemId;
                newItemElement.dataset.name = itemName;
                newItemElement.dataset.icon = icon;
                
                // Specifieke content voor custom measurements
                if (type === 'custom-training-measurement') {
                    newItemElement.dataset.customMeasurementType = 'training';
                    newItemElement.dataset.customMeasurementDefinition = JSON.stringify(contentToCopy);
                    newItemElement.dataset.content = '[]'; // Custom training definition is not 'content' for day
                } else if (type === 'custom-rest-measurement') {
                    newItemElement.dataset.customMeasurementType = 'rest';
                    newItemElement.dataset.customMeasurementDescription = contentToCopy.customMeasurementDescription || '';
                    newItemElement.dataset.customMeasurementGoals = contentToCopy.customMeasurementGoals || '';
                    newItemElement.dataset.content = '[]'; // Custom rest definition is not 'content' for day
                } else {
                    newItemElement.dataset.content = JSON.stringify(contentToCopy);
                }


                newItemElement.innerHTML = `
                    <div class="flex items-center justify-between w-full">
                        <span><i class="${icon} mr-2 ${color}"></i>${itemName}</span>
                        <i class="fas fa-grip-vertical text-gray-400"></i>
                    </div>
                `;
                document.getElementById('available-modules').appendChild(newItemElement);
                // Voeg dragstart listener toe aan het nieuwe element
                newItemElement.addEventListener('dragstart', (e) => {
                    draggedItemData = {
                        type: e.target.dataset.type,
                        name: e.target.dataset.name,
                        icon: e.target.dataset.icon,
                        id: e.target.dataset.id,
                        content: e.target.dataset.content ? JSON.parse(e.target.dataset.content) : null,
                        zoneColor: e.target.dataset.zoneColor || '',
                        duration: e.target.dataset.duration || null,
                        progressionEnabled: e.target.dataset.progressionEnabled === 'true',
                        progressionValue: e.target.dataset.progressionValue || null,
                        customMeasurementType: e.target.dataset.customMeasurementType || null,
                        customMeasurementDefinition: e.target.dataset.customMeasurementDefinition ? JSON.parse(e.target.dataset.customMeasurementDefinition) : null,
                        customMeasurementDescription: e.target.dataset.customMeasurementDescription || null,
                        customMeasurementGoals: e.target.dataset.customMeasurementGoals || null
                    };
                    e.dataTransfer.setData('text/plain', JSON.stringify(draggedItemData));
                    e.dataTransfer.effectAllowed = 'move';
                });
                showMessage(`Nieuwe ${type} '${itemName}' gemaakt!`, 'success');
            }
        }

        document.getElementById('create-day-btn').addEventListener('click', () => {
            createNewItem('day', 'Naam voor de nieuwe dag:', 'Days', 'fas fa-calendar-day', 'text-blue-300');
        });

        document.getElementById('create-week-btn').addEventListener('click', () => {
            createNewItem('week', 'Naam voor de nieuwe week:', 'Weeks', 'fas fa-calendar-week', 'text-purple-300');
        });

        document.getElementById('create-block-btn').addEventListener('click', () => { // Aangepaste ID
            createNewItem('block', 'Naam voor het nieuwe blok:', 'Bloks', 'fas fa-layer-group', 'text-cyan-300');
        });

        // Genereer tijdlabels voor de dagweergave
        function generateTimeLabels() {
            const timeLabelsContainer = document.getElementById('day-time-labels');
            timeLabelsContainer.innerHTML = '';
            for (let h = 0; h < 24; h++) {
                // Hele uren
                let label = document.createElement('div');
                label.className = 'time-slot-label';
                label.textContent = `${String(h).padStart(2, '0')}:00`;
                timeLabelsContainer.appendChild(label);
                // Halve uren
                label = document.createElement('div');
                label.className = 'time-slot-label';
                label.textContent = `${String(h).padStart(2, '0')}:30`;
                timeLabelsContainer.appendChild(label);
            }
        }

        // Roep generateTimeLabels aan bij het laden van de pagina
        document.addEventListener('DOMContentLoaded', generateTimeLabels);


        // --- Form Builder Logica ---
        const customTrainingZonesDropZone = document.getElementById('custom-training-zones-drop-zone');
        const saveCustomTrainingBtn = document.getElementById('save-custom-training-btn');
        const customTrainingNameInput = document.getElementById('custom-training-name');

        const saveCustomRestBtn = document.getElementById('save-custom-rest-btn');
        const customRestNameInput = document.getElementById('custom-rest-name');
        const customRestDescriptionInput = document.getElementById('custom-rest-description');
        const customRestGoalsInput = document.getElementById('custom-rest-goals');

        const customMeasurementsList = document.getElementById('custom-measurements-list');

        // Opslaan Aangepaste Training Meting
        saveCustomTrainingBtn.addEventListener('click', () => {
            const trainingName = customTrainingNameInput.value.trim();
            if (!trainingName) {
                showMessage('Geef de aangepaste training een naam.', 'error');
                return;
            }

            const definition = [];
            let hasError = false;
            customTrainingZonesDropZone.querySelectorAll('.dropped-item').forEach(item => {
                const durationInput = item.querySelector('[data-duration-input]');
                const duration = parseInt(durationInput.value);
                if (isNaN(duration) || duration <= 0) {
                    hasError = true;
                    showMessage('Vul een geldige duur (in minuten) in voor alle HR zones in de training.', 'error');
                    return;
                }
                definition.push({
                    type: item.dataset.type,
                    name: item.dataset.name,
                    icon: item.querySelector('i').className,
                    zoneColor: item.dataset.zoneColor || '',
                    duration: duration
                });
            });

            if (hasError) {
                return;
            }
            if (definition.length === 0) {
                showMessage('Voeg HR zones toe aan de aangepaste training.', 'error');
                return;
            }

            const customId = generateUniqueId();
            const newCustomTraining = {
                id: customId,
                name: trainingName,
                type: 'custom-training-measurement',
                icon: 'fas fa-dumbbell', // Algemeen icoon voor training
                zoneColor: 'text-yellow-500', // Kleur voor aangepaste training
                customMeasurementType: 'training',
                customMeasurementDefinition: definition
            };

            let savedCustomMeasurements = JSON.parse(localStorage.getItem('customMeasurements') || '[]');
            savedCustomMeasurements.push(newCustomTraining);
            localStorage.setItem('customMeasurements', JSON.stringify(savedCustomMeasurements));

            showMessage('Aangepaste training opgeslagen!', 'success');
            customTrainingNameInput.value = '';
            customTrainingZonesDropZone.innerHTML = '<p class="text-gray-400 text-center text-sm">Sleep HR zones hierheen om de training te definiëren.</p>';
            loadCustomMeasurements();
        });

        // Opslaan Aangepaste Rust Meting
        saveCustomRestBtn.addEventListener('click', () => {
            const restName = customRestNameInput.value.trim();
            const restDescription = customRestDescriptionInput.value.trim();
            const restGoals = customRestGoalsInput.value.trim();

            if (!restName) {
                showMessage('Geef de aangepaste rustmeting een naam.', 'error');
                return;
            }

            const customId = generateUniqueId();
            const newCustomRest = {
                id: customId,
                name: restName,
                type: 'custom-rest-measurement',
                icon: 'fas fa-moon', // Algemeen icoon voor rust
                zoneColor: 'text-blue-500', // Kleur voor aangepaste rust
                customMeasurementType: 'rest',
                customMeasurementDescription: restDescription,
                customMeasurementGoals: restGoals
            };

            let savedCustomMeasurements = JSON.parse(localStorage.getItem('customMeasurements') || '[]');
            savedCustomMeasurements.push(newCustomRest);
            localStorage.setItem('customMeasurements', JSON.stringify(savedCustomMeasurements));

            showMessage('Aangepaste rustmeting opgeslagen!', 'success');
            customRestNameInput.value = '';
            customRestDescriptionInput.value = '';
            customRestGoalsInput.value = '';
            loadCustomMeasurements();
        });

        // Laden Aangepaste Metingen naar zijbalk
        function loadCustomMeasurements() {
            // Verwijder alleen de dynamisch toegevoegde aangepaste metingen, niet de hardgecodeerde HR-zones etc.
            document.querySelectorAll('#available-modules .drag-item[data-type^="custom-"]').forEach(item => item.remove());

            const savedCustomMeasurements = JSON.parse(localStorage.getItem('customMeasurements') || '[]');

            if (savedCustomMeasurements.length === 0) {
                customMeasurementsList.innerHTML = '<p class="text-gray-400 text-sm">Geen aangepaste metingen.</p>';
                return;
            } else {
                customMeasurementsList.innerHTML = ''; // Clear placeholder if items exist
            }

            savedCustomMeasurements.forEach(measurement => {
                const measurementItem = document.createElement('div');
                measurementItem.className = 'drag-item';
                measurementItem.setAttribute('draggable', 'true');
                measurementItem.dataset.type = measurement.type; // 'custom-training-measurement' of 'custom-rest-measurement'
                measurementItem.dataset.name = measurement.name;
                measurementItem.dataset.icon = measurement.icon;
                measurementItem.dataset.id = measurement.id;
                measurementItem.dataset.zoneColor = measurement.zoneColor || '';

                if (measurement.customMeasurementType === 'training') {
                    measurementItem.dataset.customMeasurementType = 'training';
                    measurementItem.dataset.customMeasurementDefinition = JSON.stringify(measurement.customMeasurementDefinition);
                } else if (measurement.customMeasurementType === 'rest') {
                    measurementItem.dataset.customMeasurementType = 'rest';
                    measurementItem.dataset.customMeasurementDescription = measurement.customMeasurementDescription;
                    measurementItem.dataset.customMeasurementGoals = measurement.customMeasurementGoals;
                }

                measurementItem.innerHTML = `
                    <span><i class="${measurement.icon} mr-2 ${measurement.zoneColor || ''}"></i>${measurement.name}</span>
                    <button class="remove-saved-item-btn text-red-400 hover:text-red-300" data-id="${measurement.id}" data-list="customMeasurements"><i class="fas fa-times"></i></button>
                `;
                document.getElementById('available-modules').appendChild(measurementItem);
                
                // Voeg dragstart listener toe aan het nieuwe element
                measurementItem.addEventListener('dragstart', (e) => {
                    draggedItemData = {
                        type: e.target.dataset.type,
                        name: e.target.dataset.name,
                        icon: e.target.dataset.icon,
                        id: e.target.dataset.id,
                        content: e.target.dataset.content ? JSON.parse(e.target.dataset.content) : null,
                        zoneColor: e.target.dataset.zoneColor || '',
                        duration: e.target.dataset.duration || null,
                        progressionEnabled: e.target.dataset.progressionEnabled === 'true',
                        progressionValue: e.target.dataset.progressionValue || null,
                        customMeasurementType: e.target.dataset.customMeasurementType || null,
                        customMeasurementDefinition: e.target.dataset.customMeasurementDefinition ? JSON.parse(e.target.dataset.customMeasurementDefinition) : null,
                        customMeasurementDescription: e.target.dataset.customMeasurementDescription || null,
                        customMeasurementGoals: e.target.dataset.customMeasurementGoals || null
                    };
                    e.dataTransfer.setData('text/plain', JSON.stringify(draggedItemData));
                    e.dataTransfer.effectAllowed = 'move';
                });
            });
        }

        // Settings button click handler
        document.getElementById('settings-btn').addEventListener('click', () => {
            showMessage('Globale instellingen functionaliteit komt hier (nog niet geïmplementeerd).', 'info');
        });

        // Categorie selectie logica
        const categorySelect = document.getElementById('category-select');
        const categoryContents = document.querySelectorAll('.category-content');

        categorySelect.addEventListener('change', (e) => {
            const selectedCategory = e.target.value;
            categoryContents.forEach(contentDiv => {
                if (contentDiv.id === `category-${selectedCategory}`) {
                    contentDiv.classList.add('active');
                } else {
                    contentDiv.classList.remove('active');
                }
            });
        });

        // Initialiseer met de standaard geselecteerde categorie
        document.addEventListener('DOMContentLoaded', () => {
            // Activeer de Form Builder tab bij het laden
            document.querySelector('.tab-button[data-tab="form-builder"]').click();

            const initialCategory = categorySelect.value;
            categoryContents.forEach(contentDiv => {
                if (contentDiv.id === `category-${initialCategory}`) {
                    contentDiv.classList.add('active');
                } else {
                    contentDiv.classList.remove('active');
                }
            });
        });

    </script>
</body>
</html>
